<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Acme Product Management</title>

    <!-- Style sheets -->
    <link href="Content/bootstrap.css" rel="stylesheet" />
    <link href="Scripts/datatables/datatables.css" rel="stylesheet" />
    <!--<link href="Scripts/semantic/semantic.css" rel="stylesheet" />-->

</head>
<body>
    
    <script src="Scripts/jquery-3.2.1.js"></script>
    <!--<script src="Scripts/semantic/semantic.js"></script>-->

    <script type="text/javascript" src="Scripts/vue.min.js"></script>
    <script type="text/javascript" src="Scripts/axios.min.js"></script>

    <script src="Scripts/component/datatables.js"></script>


    <script src="Scripts/component/bs_combo_box.js"></script>
    <script src="travel/dataRepository.js"></script>

    <div id="travel">
        <form class="form-inline">
            <h1>Službeno butovanje</h1> 
            <div class="form-group"><town-select label="iz" v-model="order.town_from" /></div>
            <div class="form-group"><town-select label="u" v-model="order.town_to" /></div>

            <div class="form" style="margin-top:2em;">
                <div class="form-group"><town-select v-model="rel_town_from" /></div>
                <div class="form-group"><town-select label="-" v-model="rel_town_to" /></div>
                <div class="form-group"><input type="number" class="form-control text-right"  style="width:7em;" v-model:number="rel_km" /></div>
                <div class="btn btn-primary" @click="addRoute"><span class="glyphicon glyphicon-plus"></span></div>
            </div>

            <div v-if="order.relations.length >0">
                <table id="route_table" class="table table-striped table-bordered table-hover" cellspacing="0" width="100%">
                    <thead>
                        <tr>
                            <th>Polazište</th>
                            <th>Odredište</th>
                            <th width="20%">Kilometara</th>
                        </tr>
                    </thead>
                    <tbody>
                       <tr v-for="r in this.order.relations">
                           <td>{{r.town_from.name}}</td>
                           <td>{{r.town_to.name}}</td>
                           <td class="text-right">{{r.km}}</td>
                        </tr>
                    </tbody>
                    <tfoot>
                        <tr>
                            <th>Ukupno</th>
                            <th></th>
                            <th class="text-right">{{this.total_km}}</th>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </form>
    </div>

    <script type="text/javascript">


        $(document).ready(function () {
            
        });

        var travel = new Vue({
            el: "#travel",
            data: {
                order: null,
                rel_town_from: null,
                rel_town_to: null,
                rel_km: 0.0,
                total_km: 0.0
            },   
            beforeMount: function () {
                this.order = init_order;
            },
            mounted: function () {
                $('#route_table').DataTable();
                this.sumKm()
            },
            methods: {         

                sumKm: function() {

                    this.total_km = 0; 

                    for (i in this.order.relations) {
                        this.total_km += this.order.relations[i].km;
                    }
                },
                addRoute() {

                    let data = {
                        "town_from": null,
                        "town_to": null,
                        "km": Number(this.rel_km)};

                    data.town_from = this.getTownById(this.rel_town_from);
                    data.town_to = this.getTownById(this.rel_town_to);

                    this.order.relations.push(data);

                    this.sumKm();

                },
                getTownById: function (town_id) {

                    let town = null;

                    $(towns).each(function (index, data) {
                        if (data.id == town_id) {                           
                            town =  data;
                        }
                    });
                    return town;
                }
            }

        });

      
 

    </script>

</body>

</html>